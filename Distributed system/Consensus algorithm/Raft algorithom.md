不同於Paxos, Raft使用Leader(領導者)、Follower(追隨者)等更直觀的術語
並且簡化了複雜的流程,以下方便說明,使用三種角色代表圖
![[rule.png]]

## Leader Election 

 1. **初始化狀態**： 所有節點初始狀態都是Follower, 沒有Leader存在時,所有節點不會收到心跳消息
   ![[Pasted image 20240517101007.png]]

 
 2. **超時觸發選舉**： - 任何一個Follower節點在一定時間內沒有收到來自Leader的心跳訊號（Heartbeat），它會自己轉變為Candidate
 
  
  
 3. **發送投票請求**： - Candidate節點向其他所有節點發送RequestVote請求，並附帶其當前的日誌索引和任期號。 
  
  
  
 4. **接受投票**： - 其他節點（Followers）收到RequestVote請求後，會根據Candidate的日誌索引和任期號決定是否投票。如果該Candidate的日誌比自己更新，且尚未投票給其他Candidate，則會投票給該Candidate。 
  
  
  
 5. **當選為Leader**： - Candidate節點如果獲得多數節點的投票（超過半數），則成為Leader。當選後，它會立即向其他節點發送心跳訊號，通知其成為新的Leader。 
  
  
  
 6. **處理失敗情況**： - 如果Candidate在一定時間內沒有獲得足夠的投票，它會重新進入Follower狀態，並等待下一次選舉超時再次發起選舉。
  
  
  
## 初始狀態


 在Raft中有兩種timeout設定
		a. Election timeout.
			150ms and 300ms.
		b. se








- 
- 選舉超時導致發起選舉
    - 如果一個Follower節點在選舉超時時間內沒有收到任何節點的消息(心跳或日誌條目)
    - 該節點就會進入Candidate狀態,發起新一輪的領導者選舉
- 多個節點同時成為Candidate
    - 有可能發生所有節點在同一時間內都因為選舉超時而進入Candidate狀態
    - 可能原因包括:集群啟動、網絡分區、領導者突然宕機、選舉定時器不一致等
- 競爭領導權
    - 多個Candidate同時向其他節點發送請求投票消息
    - 消息包含該節點的任期號和最後日誌索引號
    - 其他節點會先檢查發送請求節點的日誌是否至少與自己的一致,如果不落後則投贊成票
- 選舉完成
    - 一個Candidate節點獲得超過集群半數節點的贊成票後,就能成功當選為Leader
    - Leader立即向所有節點發送心跳消息,並附帶從上一任期已提交日誌開始的日誌條目
    - 其他節點確認Leader身份,重置選舉超時計時器,進入正常運行狀態
- 日誌複製
    - 客戶端向Leader發送指令
    - Leader先臨時添加指令到本地日誌
    - 並行發送日誌條目給其他節點
    - 超過半數節點成功追加後,Leader提交並通知全部節點
- 領導權轉移
    - 如果Leader宕機或與過半節點失去聯繫
    - 其他節點在選舉超時後會重新進入Candidate狀態觸發新一輪選舉